<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	th:replace="~{base::layout(~{::section})}">

<head>
<meta charset="UTF-8">
<title>Game Library</title>
</head>

<body>
	<section>
		<div class="container" style="margin-top: 80px; margin-bottom: 60px;">

			<!-- Header -->
			<div class="text-center mb-4">
				<h2 class="fw-bold"><i class="fa-solid fa-gamepad me-2"></i>My Game Library</h2>
				<p class="text-muted">All your purchased games in one place</p>
			</div>

			<!-- Success/Error Messages -->
			<th:block th:if="${session.succMsg}">
				<div class="alert alert-success text-center" role="alert">
					[[${session.succMsg}]]
				</div>
				<th:block th:text="${@commnServiceImpl.removeSessionMessage()}"></th:block>
			</th:block>
			<th:block th:if="${session.errorMsg}">
				<div class="alert alert-danger text-center" role="alert">
					[[${session.errorMsg}]]
				</div>
				<th:block th:text="${@commnServiceImpl.removeSessionMessage()}"></th:block>
			</th:block>

			<!-- Games Count Badge -->
			<div class="mb-4">
				<span class="badge bg-primary fs-6">
					<i class="fa-solid fa-layer-group me-1"></i> [[${gamesCount}]] Game(s) in Library
				</span>
			</div>

			<!-- Empty Library -->
			<th:block th:if="${games == null or games.isEmpty()}">
				<div class="text-center py-5">
					<div class="mb-4">
						<i class="fa-solid fa-ghost fa-5x text-muted"></i>
					</div>
					<h4 class="text-muted mb-3">Your Library is Empty</h4>
					<p class="text-muted mb-4">Purchase games from our store to see them here!</p>
					<a href="/products" class="btn btn-primary btn-lg">
						<i class="fa-solid fa-store me-2"></i>Browse Games
					</a>
				</div>
			</th:block>

			<!-- Game Cards -->
			<div class="row g-4" th:if="${games != null and !games.isEmpty()}">
				<div class="col-lg-4 col-md-6" th:each="game : ${games}">
					<div class="card h-100 shadow-sm border-0" style="border-radius: 12px; overflow: hidden;">
						<!-- Game Image -->
						<div class="position-relative">
							<img th:src="${game.product.image}" class="card-img-top"
								th:alt="${game.product.title}"
								style="height: 220px; object-fit: cover;">
							<!-- Owned Badge -->
							<span class="badge bg-success position-absolute top-0 end-0 m-2">
								<i class="fa-solid fa-check-circle me-1"></i> Owned
							</span>
						</div>

						<!-- Game Info -->
						<div class="card-body d-flex flex-column">
							<h5 class="card-title fw-bold" th:text="${game.product.title}"></h5>
							<p class="card-text text-muted small mb-2">
								<i class="fa-solid fa-tag me-1"></i> [[${game.product.category}]]
							</p>
							<p class="card-text text-muted small mb-3" 
								th:text="${#strings.abbreviate(game.product.description, 100)}"></p>

							<!-- Purchase Info -->
							<div class="mb-3 small text-muted">
								<div><i class="fa-solid fa-calendar me-1"></i> Purchased: 
									<span th:text="${#temporals.format(game.purchaseDate, 'dd/MM/yyyy HH:mm')}"></span>
								</div>
								<div th:if="${game.product.fileSize}">
									<i class="fa-solid fa-hard-drive me-1"></i> Size: [[${game.product.fileSize}]]
								</div>
							</div>

							<!-- Download Button -->
							<div class="mt-auto">
								<th:block th:if="${game.product.downloadLink != null and game.product.downloadLink != ''}">
									<a th:href="${game.product.downloadLink}" 
										class="btn btn-primary w-100"
										target="_blank"
										th:onclick="'fetch(\'/user/game-library/download/' + ${game.id} + '\')'">
										<i class="fa-solid fa-download me-2"></i> 
										<span th:if="${game.isDownloaded}">Download Again</span>
										<span th:unless="${game.isDownloaded}">Download</span>
									</a>
								</th:block>
								<th:block th:if="${game.product.downloadLink == null or game.product.downloadLink == ''}">
									<button class="btn btn-secondary w-100" disabled>
										<i class="fa-solid fa-clock me-2"></i> Download Coming Soon
									</button>
								</th:block>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Browse More -->
			<div class="text-center mt-5" th:if="${games != null and !games.isEmpty()}">
				<a href="/products" class="btn btn-outline-primary btn-lg">
					<i class="fa-solid fa-store me-2"></i> Browse More Games
				</a>
			</div>
		</div>
	</section>
</body>
</html>
</body>
</html>
